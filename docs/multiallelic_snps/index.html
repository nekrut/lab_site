<!doctype html>

<html lang="en" class="h-100">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>
  <meta name="generator" content="Hugo 0.58.3" />
  <link rel="stylesheet" href="https://nekrut.github.io/lab_site/css/bootstrap.min.css">
  
  
  <title>Parsing multiallelic sites | AN LAB</title>
  <style>
.container {
  max-width: 700px;
}
#nav a {
  font-weight: bold;
  color: inherit;
}
#nav a.nav-link-active {
  background-color: #212529;
  color: #fff;
}
#nav-border {
  border-bottom: 1px solid #212529;
}
#main {
  margin-top: 1em;
  margin-bottom: 4em;
}
#home-jumbotron {
  background-color: inherit;
}
#footer .container {
  padding: 1em 0;
}
#footer a {
  color: inherit;
  text-decoration: underline;
}
.font-125 {
  font-size: 125%;
}
.tag-btn {
  margin-bottom: 0.3em;
}
pre {
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 16px;
}
pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  background-color: transparent;
  border-radius: 0;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 4px;
}
img,
iframe,
embed,
video,
audio {
  max-width: 100%;
}
.card-img,
.card-img-top,
.card-img-bottom {
  width: initial;
}
</style>
</head>
  <body class="d-flex flex-column h-100">
    <div id="nav-border" class="container">
  <nav id="nav" class="nav justify-content-center">
  
  
  
    
    
      
      
      
      
        
      
    
    
    <a class="nav-link " href="/lab_site/"><i data-feather="home"></i> Home</a>
  
    
    
      
      
      
      
        
      
    
    
    <a class="nav-link " href="/lab_site/people/"><i data-feather="smile"></i> People</a>
  
    
    
      
      
      
      
        
      
    
    
    <a class="nav-link " href="/lab_site/pubs/"><i data-feather="book-open"></i> Pubs</a>
  
    
    
      
      
      
      
       
        
        
      
    
    
    <a class="nav-link nav-link-active" href="/lab_site/post/"><i data-feather="file-text"></i> Blog</a>
  
    
    
      
      
      
      
        
      
    
    
    <a class="nav-link " href="/lab_site/coord/"><i data-feather="map-pin"></i> Coord</a>
  
    
    
      
      
      
      
        
      
    
    
    <a class="nav-link " href="http://galaxyproject.org"><i data-feather="arrow-up"></i> Galaxy</a>
  
  </nav>
</div>
    <div class="container">
      <main id="main">
        

<h1>Parsing multiallelic sites</h1>


<i data-feather="calendar"></i> <time datetime="2019-08-26">Aug 26, 2019</time>

  <br>
  <i data-feather="tag"></i>
  
  
  <a class="btn btn-sm btn-outline-dark tag-btn" href="https://nekrut.github.io/lab_site/tags/snp">snp</a>
  
  
  <a class="btn btn-sm btn-outline-dark tag-btn" href="https://nekrut.github.io/lab_site/tags/vcf">VCF</a>
  
  
  <a class="btn btn-sm btn-outline-dark tag-btn" href="https://nekrut.github.io/lab_site/tags/variant-calling">variant calling</a>
  

<br><br>


<p>by AN</p>

<hr />

<div class="alert alert-warning" role="alert">
    In diploid systems (e.g., human) multiallelic sites are often ignored. However, in bacterial and viral mixtures multiallelic sites are real and parsing them correctly is critical for understanding the full magnitude of sequence variation. 
</div>

<h2 id="the-goal">The goal</h2>

<p>To compare various ways of calling variants in haploid systems I needed to convert VCF files into TAB-delimited format, while parsing out multiallelic sites.</p>

<h2 id="the-data">The data</h2>

<p>In this experiment we called SNPs from Illumina data obtained by sequencing of HIV&rsquo;s <em>pol</em> gene amplicons. The data was generated by <a href="http://dx.doi.org/10.1371/journal.pone.0214820">Jair et al. 2019</a>. For the sake of brevity the following discussion uses a single dataset from this study with accession <a href="https://www.ncbi.nlm.nih.gov/sra/?term=SRR8525899">SRR8525899</a>.</p>

<p>Variants were called using <code>freebayes</code> (version <kbd>1.3.1</kbd> build <kbd>py37he0122c3_0</kbd> from <a href="https://bioconda.github.io/recipes/freebayes/README.html">bioconda</a>) and <code>Mutect2</code> (GATK version <kbd>4.1.3.0</kbd> build <kbd>0</kbd> from <a href="https://anaconda.org/bioconda/gatk4">bioconda</a>). The following commands were used to call variants (in both cases <code>hxb2</code> refers to the reference sequence for the <a href="https://www.ncbi.nlm.nih.gov/nuccore/K03455.1/">HIV genome (K03455.1)</a>:</p>

<h4 id="freebayes">FreeBayes:</h4>

<p><code>freebayes -f hxb2.fa --min-coverage 100 --limit-coverage 1000 --haplotype-length 0 -q 20 -m 20 --min-alternate-count 1 --min-alternate-fraction 0 --pooled-continuous &lt;BAM dataset&gt; &gt; &lt;VCF file&gt;</code></p>

<h4 id="mutect2">Mutect2:</h4>

<p><code>gatk Mutect2 -I &lt;BAM dataset&gt; -mbq 20 -R hxb2.fa --mitochondria-mode True -O &lt;VCF file&gt;</code></p>

<h2 id="the-site">The site</h2>

<p>Resulting VCFs contained a number of multiallelic sites. Here is an example of a complex site identified by <code>freebayes</code>:</p>

<pre><code>K03455.1        2911    .       ATG     CCA,GCA,ACA,ACG,ATA     10482.7 .       AB=0,0,0,0,0;ABP=0,0,0,0,0;AC=0,0,2,0,0;AF=0,0,1,0,0;AN=2;AO=1,2,310,1,2;CIGAR=3X,3X,1M2X,1M1X1M,2M1X;DP=316;DPB=316;DPRA=0,0,0,0,0;EPP=5.18177,3.0103,5.8122,5.18177,3.0103;EPPR=0;GTI=0;LEN=3,3,2,1,1;MEANALT=5,5,5,5,5;MQM=60,60,59.9032,60,60;MQMR=0;NS=1;NUMALT=5;ODDS=413.347;PAIRED=1,1,1,1,1;PAIREDR=0;PAO=0,0,0,0,0;PQA=0,0,0,0,0;PQR=0;PRO=0;QA=27,76,11724,39,72;QR=0;RO=0;RPL=1,2,165,1,2;RPP=5.18177,7.35324,5.8122,5.18177,7.35324;RPPR=0;RPR=0,0,145,0,0;RUN=1,1,1,1,1;SAF=0,1,178,1,1;SAP=5.18177,3.0103,17.8324,5.18177,3.0103;SAR=1,1,132,0,1;SRF=0;SRP=0;SRR=0;TYPE=complex,complex,mnp,snp,snp      GT:DP:AD:RO:QR:AO:QA:GL 3/3:316:0,1,2,310,1,2:0:0:1,2,310,1,2:27,76,11724,39,72:-1054.34,-1052.22,-1051.91,-1048.11,-1045.98,-1047.51,-93.3193,-91.2078,-87.0746,0,-1051.14,-1049.01,-1044.9,-90.1068,-1050.84,-1048.47,-1046.34,-1042.24,-87.4429,-1045.26,-1047.87
</code></pre>

<p>There are five alternative alleles. This is why tags describing these alleles contain lists of values instead of a single value. For example, <code>AO</code> (Count of full observations of this alternate haplotype) is <code>1,2,310,1,2</code> and so on. If you look carefully at this site you will see that it is actually <em>almost</em> fixed for <code>ACA</code> with other alleles having very low counts and no reference allele is present.</p>

<p>For meaningful processing of these data (at least in my mind) it is necessary to split multiple alleles into individual events and then deal with them separately. In fact, in the study I am trying to complete I am comparing various variant callers applied to a variety of non-diploid systems randing from viruses to human mitichondria. So my goal is to convert VCF datasets into tab-delimited files that I can import into <code>Pandas</code> and analyze happily. So how can only split multiallelic VCF entries without writing another parser.</p>

<h2 id="splitting-multiallelic-vcf-entries">Splitting multiallelic VCF entries</h2>

<h3 id="vcflib">VCFlib</h3>

<p><a href="https://github.com/vcflib/vcflib"><code>VCFlib</code></a> is a fast C-based collection of utilities for processing of VCF data (here I am using <code>vcflib</code> version <kbd>1.0.0_rc2</kbd> build <kbd>he0122c3_2</kbd> from <a href="https://anaconda.org/bioconda/vcflib">bioconda</a>). For our purpose it has a specifically designed utility called <a href="https://github.com/vcflib/vcflib#vcfbreakmulti"><code>vcfbreakmulti</code></a>. Let&rsquo;s try it on out site. Here is what we get:</p>

<pre><code>K03455.1        2911    .       ATG     CCA     10482.7 .       AB=0;ABP=0;AC=0;AF=0;AN=2;AO=1;CIGAR=3X;DP=316;DPB=316;DPRA=0;EPP=5.18177;EPPR=0;GTI=0;LEN=3;MEANALT=5;MQM=60;MQMR=0;NS=1;NUMALT=5;ODDS=413.347;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=27;QR=0;RO=0;RPL=1;RPP=5.18177;RPPR=0;RPR=0;RUN=1;SAF=0;SAP=5.18177;SAR=1;SRF=0;SRP=0;SRR=0;TYPE=complex  GT:DP:AD:RO:QR:AO:QA:GL ./.:316:0,1,2,310,1,2:0:0:1:27:-1054.34,-1052.22,-1051.91
K03455.1        2911    .       ATG     GCA     10482.7 .       AB=0;ABP=0;AC=0;AF=0;AN=2;AO=2;CIGAR=3X;DP=316;DPB=316;DPRA=0;EPP=3.0103;EPPR=0;GTI=0;LEN=3;MEANALT=5;MQM=60;MQMR=0;NS=1;NUMALT=5;ODDS=413.347;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=76;QR=0;RO=0;RPL=2;RPP=7.35324;RPPR=0;RPR=0;RUN=1;SAF=1;SAP=3.0103;SAR=1;SRF=0;SRP=0;SRR=0;TYPE=complex    GT:DP:AD:RO:QR:AO:QA:GL ./.:316:0,1,2,310,1,2:0:0:2:76:-1054.34,-1048.11,-1047.51
K03455.1        2911    .       ATG     ACA     10482.7 .       AB=0;ABP=0;AC=2;AF=1;AN=2;AO=310;CIGAR=1M2X;DP=316;DPB=316;DPRA=0;EPP=5.8122;EPPR=0;GTI=0;LEN=2;MEANALT=5;MQM=59.9032;MQMR=0;NS=1;NUMALT=5;ODDS=413.347;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=11724;QR=0;RO=0;RPL=165;RPP=5.8122;RPPR=0;RPR=145;RUN=1;SAF=178;SAP=17.8324;SAR=132;SRF=0;SRP=0;SRR=0;TYPE=mnp    GT:DP:AD:RO:QR:AO:QA:GL 1/1:316:0,1,2,310,1,2:0:0:310:11724:-1054.34,-93.3193,0
K03455.1        2911    .       ATG     ACG     10482.7 .       AB=0;ABP=0;AC=0;AF=0;AN=2;AO=1;CIGAR=1M1X1M;DP=316;DPB=316;DPRA=0;EPP=5.18177;EPPR=0;GTI=0;LEN=1;MEANALT=5;MQM=60;MQMR=0;NS=1;NUMALT=5;ODDS=413.347;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=39;QR=0;RO=0;RPL=1;RPP=5.18177;RPPR=0;RPR=0;RUN=1;SAF=1;SAP=5.18177;SAR=0;SRF=0;SRP=0;SRR=0;TYPE=snp  GT:DP:AD:RO:QR:AO:QA:GL ./.:316:0,1,2,310,1,2:0:0:1:39:-1054.34,-1051.14,-1050.84
K03455.1        2911    .       ATG     ATA     10482.7 .       AB=0;ABP=0;AC=0;AF=0;AN=2;AO=2;CIGAR=2M1X;DP=316;DPB=316;DPRA=0;EPP=3.0103;EPPR=0;GTI=0;LEN=1;MEANALT=5;MQM=60;MQMR=0;NS=1;NUMALT=5;ODDS=413.347;PAIRED=1;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=72;QR=0;RO=0;RPL=2;RPP=7.35324;RPPR=0;RPR=0;RUN=1;SAF=1;SAP=3.0103;SAR=1;SRF=0;SRP=0;SRR=0;TYPE=snp      GT:DP:AD:RO:QR:AO:QA:GL ./.:316:0,1,2,310,1,2:0:0:2:72:-1054.34,-1048.47,-1047.87
</code></pre>

<p>looking at VCFs is truly a unique form of a cruel punishment, so let&rsquo;s take a closer look at <code>INFO</code>- and <code>FORMAT</code>- level fields. This can be done through a combination of <code>vcfbreakmulti</code>, <code>vcf2tsv</code> (another utility from <code>vcflib</code> package that converts VCF into tab-delimited data), <a href="https://www.gnu.org/software/datamash/manual/datamash.html#Transpose"><code>datamash</code></a> <code>transpose</code> function (<code>freebayes</code> tags are descriubed in the <a href="#appendix-freebayes-vcf-tags">appendix</a>):</p>

<pre><code>cat &lt;VCF file&gt; | vcfbreakmulti | vcf2tsv | datamash transpose
</code></pre>

<div class="alert alert-success" role="alert">
Adding <tt>-g</tt> flag to <tt>vcf2tsv</tt> will parse genotype fields as well.
</div>






<table class="table table-sm">
<thead>
<tr>
<th>Field</th>
<th>A1</th>
<th>A2</th>
<th>A3</th>
<th>A4</th>
<th>A5</th>
</tr>
</thead>

<tbody>
<tr>
<td>POS</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
</tr>

<tr>
<td>ID</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
</tr>

<tr>
<td>REF</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
</tr>

<tr>
<td>ALT</td>
<td>CCA</td>
<td>GCA</td>
<td>ACA</td>
<td>ACG</td>
<td>ATA</td>
</tr>

<tr>
<td>QUAL</td>
<td>10482.7</td>
<td>10482.7</td>
<td>10482.7</td>
<td>10482.7</td>
<td>10482.7</td>
</tr>

<tr>
<td>FILTER</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
</tr>

<tr>
<td>AB</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>ABP</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>AC</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>AF</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>AN</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>

<tr>
<td>AO</td>
<td>1</td>
<td>2</td>
<td>310</td>
<td>1</td>
<td>2</td>
</tr>

<tr>
<td>CIGAR</td>
<td>3X</td>
<td>3X</td>
<td>1M2X</td>
<td>1M1X1M</td>
<td>2M1X</td>
</tr>

<tr>
<td>DP</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
</tr>

<tr>
<td>DPB</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
</tr>

<tr>
<td>DPRA</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>END</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
</tr>

<tr>
<td>EPP</td>
<td>5.18177</td>
<td>3.0103</td>
<td>5.8122</td>
<td>5.18177</td>
<td>3.0103</td>
</tr>

<tr>
<td>EPPR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>GTI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>LEN</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>MEANALT</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
</tr>

<tr>
<td>MIN_DP</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
<td>.</td>
</tr>

<tr>
<td>MQM</td>
<td>60</td>
<td>60</td>
<td>59.9032</td>
<td>60</td>
<td>60</td>
</tr>

<tr>
<td>MQMR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>NS</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>NUMALT</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
</tr>

<tr>
<td>ODDS</td>
<td>413.347</td>
<td>413.347</td>
<td>413.347</td>
<td>413.347</td>
<td>413.347</td>
</tr>

<tr>
<td>PAIRED</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>PAIREDR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PAO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PQA</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PQR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PRO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>QA</td>
<td>27</td>
<td>76</td>
<td>11724</td>
<td>39</td>
<td>72</td>
</tr>

<tr>
<td>QR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RPL</td>
<td>1</td>
<td>2</td>
<td>165</td>
<td>1</td>
<td>2</td>
</tr>

<tr>
<td>RPP</td>
<td>5.18177</td>
<td>7.35324</td>
<td>5.8122</td>
<td>5.18177</td>
<td>7.35324</td>
</tr>

<tr>
<td>RPPR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RPR</td>
<td>0</td>
<td>0</td>
<td>145</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RUN</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>SAF</td>
<td>0</td>
<td>1</td>
<td>178</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>SAP</td>
<td>5.18177</td>
<td>3.0103</td>
<td>17.8324</td>
<td>5.18177</td>
<td>3.0103</td>
</tr>

<tr>
<td>SAR</td>
<td>1</td>
<td>1</td>
<td>132</td>
<td>0</td>
<td>1</td>
</tr>

<tr>
<td>SRF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRP</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>TYPE</td>
<td>complex</td>
<td>complex</td>
<td>mnp</td>
<td>snp</td>
<td>snp</td>
</tr>
</tbody>
</table>

<h3 id="gatk">GATK</h3>

<p>GATK&rsquo;s equivalent of <code>vcflib</code>&rsquo;s  <code>vcfbreakmulti | vcf2tab</code> combination is <a href="https://software.broadinstitute.org/gatk/documentation/tooldocs/current/org_broadinstitute_hellbender_tools_walkers_variantutils_VariantsToTable.php"><code>VariantsToTable</code></a> (also see <a href="https://software.broadinstitute.org/gatk/documentation/tooldocs/current/org_broadinstitute_hellbender_tools_walkers_variantutils_LeftAlignAndTrimVariants.php">LeftAlignAndTrimVariants</a>. Here I used GATK version <kbd>4.1.3.0</kbd> build <kbd>0</kbd> from <a href="https://anaconda.org/bioconda/gatk4">bioconda</a>.</p>

<p>One functional difference with <code>vcfbreakmulti</code> discussed above is the fact that  <code>VariantsToTable</code> requires the user to explicitly define which tags to parse. For example, to parse a VCF file generated with <code>freebayes</code> the command line will look like this:</p>

<pre><code>gatk VariantsToTable -SMA -V &lt;BAM input&gt; -O &lt;TAB-delimited output&gt; -F POS -F REF -F ALT -F NS -F DP -F DPB -F AC -F AN -F AF -F RO -F AO -F PRO -F PAO -F QR -F QA -F PQR -F PQA -F SRF -F SRR -F SAF -F SAR -F SRP -F SAP -F AB -F ABP -F RUN -F RPP -F RPPR -F RPL -F RPR -F EPP -F EPPR -F DPRA -F ODDS -F GTI -F TYPE -F CIGAR -F NUMALT -F MEANALT -F LEN -F MQM -F MQMR -F PAIRED -F PAIREDR -F MIN_DP -F END -GF GT -GF GQ -GF GL -GF DP -GF AD -GF RO -GF QR -GF AO -GF QA -GF MIN_DP
</code></pre>

<div class="alert alert-success" role="alert">
Note the <tt>-SMA</tt> flag, which tells the tool to split multiallelic sites. The <tt>-GF</tt> flag is equivalent to <tt>-g</tt> flag of <tt>vcf2tab</tt>.
</div>

<p>In the case of our site running the above command and processing its output with:</p>

<pre><code>cat &lt;TAB-delimited output of VariantsToTable | datamash transpose 
</code></pre>






<table class="table table-sm">
<thead>
<tr>
<th>Field</th>
<th>A1</th>
<th>A2</th>
<th>A3</th>
<th>A4</th>
<th>A5</th>
</tr>
</thead>

<tbody>
<tr>
<td>POS</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
</tr>

<tr>
<td>REF</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
</tr>

<tr>
<td>ALT</td>
<td>CCA</td>
<td>GCA</td>
<td>ACA</td>
<td>ACG</td>
<td>ATA</td>
</tr>

<tr>
<td>NS</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>DP</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
</tr>

<tr>
<td>DPB</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
</tr>

<tr>
<td>AC</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>AN</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
</tr>

<tr>
<td>AF</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>AO</td>
<td>1</td>
<td>2</td>
<td>310</td>
<td>1</td>
<td>2</td>
</tr>

<tr>
<td>PRO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PAO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>QR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>QA</td>
<td>27</td>
<td>76</td>
<td>11724</td>
<td>39</td>
<td>72</td>
</tr>

<tr>
<td>PQR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PQA</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SAF</td>
<td>0</td>
<td>1</td>
<td>178</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>SAR</td>
<td>1</td>
<td>1</td>
<td>132</td>
<td>0</td>
<td>1</td>
</tr>

<tr>
<td>SRP</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SAP</td>
<td>5.18177</td>
<td>3.0103</td>
<td>17.8324</td>
<td>5.18177</td>
<td>3.0103</td>
</tr>

<tr>
<td>AB</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>ABP</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RUN</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>RPP</td>
<td>5.18177</td>
<td>7.35324</td>
<td>5.8122</td>
<td>5.18177</td>
<td>7.35324</td>
</tr>

<tr>
<td>RPPR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>RPL</td>
<td>1</td>
<td>2</td>
<td>165</td>
<td>1</td>
<td>2</td>
</tr>

<tr>
<td>RPR</td>
<td>0</td>
<td>0</td>
<td>145</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>EPP</td>
<td>5.18177</td>
<td>3.0103</td>
<td>5.8122</td>
<td>5.18177</td>
<td>3.0103</td>
</tr>

<tr>
<td>EPPR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>DPRA</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>ODDS</td>
<td>413.347</td>
<td>413.347</td>
<td>413.347</td>
<td>413.347</td>
<td>413.347</td>
</tr>

<tr>
<td>GTI</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>TYPE</td>
<td>MNP</td>
<td>MNP</td>
<td>MNP</td>
<td>MNP</td>
<td>MNP</td>
</tr>

<tr>
<td>CIGAR</td>
<td>3X</td>
<td>3X</td>
<td>1M2X</td>
<td>1M1X1M</td>
<td>2M1X</td>
</tr>

<tr>
<td>NUMALT</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
</tr>

<tr>
<td>MEANALT</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
<td>5</td>
</tr>

<tr>
<td>LEN</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>MQM</td>
<td>60</td>
<td>60</td>
<td>59.9032</td>
<td>60</td>
<td>60</td>
</tr>

<tr>
<td>MQMR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>PAIRED</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>PAIREDR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>MIN_DP</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>

<tr>
<td>END</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>

<tr>
<td>SRR8525899.GT</td>
<td>ACA/ACA</td>
<td>ACA/ACA</td>
<td>ACA/ACA</td>
<td>ACA/ACA</td>
<td>ACA/ACA</td>
</tr>

<tr>
<td>SRR8525899.GQ</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>

<tr>
<td>SRR8525899.GL</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>

<tr>
<td>SRR8525899.DP</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
</tr>

<tr>
<td>SRR8525899.AD</td>
<td>0,1,2,310,1,2</td>
<td>0,1,2,310,1,2</td>
<td>0,1,2,310,1,2</td>
<td>0,1,2,310,1,2</td>
<td>0,1,2,310,1,2</td>
</tr>

<tr>
<td>SRR8525899.RO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRR8525899.QR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRR8525899.AO</td>
<td>1,2,310,1,2</td>
<td>1,2,310,1,2</td>
<td>1,2,310,1,2</td>
<td>1,2,310,1,2</td>
<td>1,2,310,1,2</td>
</tr>

<tr>
<td>SRR8525899.QA</td>
<td>27,76,11724,39,72</td>
<td>27,76,11724,39,72</td>
<td>27,76,11724,39,72</td>
<td>27,76,11724,39,72</td>
<td>27,76,11724,39,72</td>
</tr>

<tr>
<td>SRR8525899.MIN_DP</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
</tbody>
</table>

<h3 id="bcftools">bcftools</h3>

<p><a href="https://github.com/samtools/bcftools"><code>bcftools</code></a> can be used to achieve the same result with two utilities: <code>norm</code> and <code>query</code>. Here I used <code>bcftools</code> version <kbd>1.9</kbd>, build <kbd>h444d1bb_5</kbd> installed using <a href="https://anaconda.org/bioconda/vcftools">bioconda</a>. In case of <code>query</code> one needs to explicitly write the format of the output including names of fields, delimiters, and end-of-the-line characters:</p>

<pre><code>bcftools norm -m - SRR8525899_f.vcf | bcftools query -f '%CHROM\t%POS\t%REF\t%DP\t%RO\t%AO\t%ALT\t%SAF\t%SAR\t%SRF\t%SRR\n'
</code></pre>

<p>The output will look like this (this is, again, a transposed version for clarity):</p>






<table class="table table-sm">
<thead>
<tr>
<th>Field</th>
<th>A1</th>
<th>A2</th>
<th>A3</th>
<th>A4</th>
<th>A5</th>
</tr>
</thead>

<tbody>
<tr>
<td>POS</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
<td>2911</td>
</tr>

<tr>
<td>REF</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
<td>ATG</td>
</tr>

<tr>
<td>ALT</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
<td>316</td>
</tr>

<tr>
<td>RO</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>AO</td>
<td>1</td>
<td>2</td>
<td>310</td>
<td>1</td>
<td>2</td>
</tr>

<tr>
<td>ALT</td>
<td>CCA</td>
<td>GCA</td>
<td>ACA</td>
<td>ACG</td>
<td>ATA</td>
</tr>

<tr>
<td>SAF</td>
<td>0</td>
<td>1</td>
<td>178</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td>SAR</td>
<td>1</td>
<td>1</td>
<td>132</td>
<td>0</td>
<td>1</td>
</tr>

<tr>
<td>SRF</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>

<tr>
<td>SRR</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<h2 id="conclusions">Conclusions</h2>

<h3 id="usability">Usability</h3>

<p>The three approaches, <code>vcflib</code>, <code>gatk</code>, and <code>bcftools</code> all achieve the same result (obviously).</p>

<ul>
<li><code>vcftools</code> is perhaps the easiest way to do this because it does not require <em>a priori</em> knowledge of all the fields in the VCF file - it just parses them all. However, in some instances <code>vcfbreakmulti</code> was hanging on certain files that contain variants with large number of alternative alleles (low complexity regions). This is intermittent: sometimes it hangs and sometimes it does not (I wasn&rsquo;t able to pinpoint the exact cause). It is really straightforward to pipe from one <code>vcflib</code> utility to another.</li>
<li><code>gatk</code>&rsquo;s <code>VariantsToTable</code> is one command that does both things - splits multiallelic sites and converts to tab-delimited format. The challenge is forming the correct command line with all VCF flags to extract. Piping is a little weird with <code>gatk</code> as you need to explicitly state <code>-O /dev/stdout</code>.</li>
<li><code>bcftools</code> requires the use of two utilities and also forces the user to construct the list of fields and formatting options. Just like in the case of <code>vcflib</code> piping is easy.</li>
</ul>

<h3 id="project-health">Project health</h3>

<p>Here is a simple GitHub-based statistics (as of August 27, 2018):</p>






<table class="table table-sm text-nowrap">
<thead>
<tr>
<th>Tool</th>
<th>Last</th>
<th>Total</th>
<th># Issues</th>
<th># PRs</th>
<th># Releases</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>vcflib</code></td>
<td>Aug 7 2019</td>
<td>724</td>
<td><sup>118</sup>&frasl;<sub>63</sub></td>
<td><sup>8</sup>&frasl;<sub>63</sub></td>
<td>4</td>
</tr>

<tr>
<td><code>gatk</code></td>
<td>Aug 27 2019</td>
<td>3931</td>
<td><sup>961</sup>&frasl;<sub>2556</sub></td>
<td><sup>67</sup>&frasl;<sub>2540</sub></td>
<td>38</td>
</tr>

<tr>
<td><code>bcftools</code></td>
<td>Aug 20 2019</td>
<td>2064</td>
<td><sup>147</sup>&frasl;<sub>762</sub></td>
<td><sup>3</sup>&frasl;<sub>162</sub></td>
<td>28</td>
</tr>
</tbody>
</table>

<p>Based on this <code>bcftools</code> is probably the best option as it is well maintained and is not written in java ;).</p>

<h2 id="appendix-freebayes-vcf-header">Appendix: FreeBayes VCF header</h2>

<pre><code>##INFO=&lt;ID=NS,Number=1,Type=Integer,Description=&quot;Number of samples with data&quot;&gt;
##INFO=&lt;ID=DP,Number=1,Type=Integer,Description=&quot;Total read depth at the locus&quot;&gt;
##INFO=&lt;ID=DPB,Number=1,Type=Float,Description=&quot;Total read depth per bp at the locus; bases in reads overlapping / bases in haplotype&quot;&gt;
##INFO=&lt;ID=AC,Number=A,Type=Integer,Description=&quot;Total number of alternate alleles in called genotypes&quot;&gt;
##INFO=&lt;ID=AN,Number=1,Type=Integer,Description=&quot;Total number of alleles in called genotypes&quot;&gt;
##INFO=&lt;ID=AF,Number=A,Type=Float,Description=&quot;Estimated allele frequency in the range (0,1]&quot;&gt;
##INFO=&lt;ID=RO,Number=1,Type=Integer,Description=&quot;Count of full observations of the reference haplotype.&quot;&gt;
##INFO=&lt;ID=AO,Number=A,Type=Integer,Description=&quot;Count of full observations of this alternate haplotype.&quot;&gt;
##INFO=&lt;ID=PRO,Number=1,Type=Float,Description=&quot;Reference allele observation count, with partial observations recorded fractionally&quot;&gt;
##INFO=&lt;ID=PAO,Number=A,Type=Float,Description=&quot;Alternate allele observations, with partial observations recorded fractionally&quot;&gt;
##INFO=&lt;ID=QR,Number=1,Type=Integer,Description=&quot;Reference allele quality sum in phred&quot;&gt;
##INFO=&lt;ID=QA,Number=A,Type=Integer,Description=&quot;Alternate allele quality sum in phred&quot;&gt;
##INFO=&lt;ID=PQR,Number=1,Type=Float,Description=&quot;Reference allele quality sum in phred for partial observations&quot;&gt;
##INFO=&lt;ID=PQA,Number=A,Type=Float,Description=&quot;Alternate allele quality sum in phred for partial observations&quot;&gt;
##INFO=&lt;ID=SRF,Number=1,Type=Integer,Description=&quot;Number of reference observations on the forward strand&quot;&gt;
##INFO=&lt;ID=SRR,Number=1,Type=Integer,Description=&quot;Number of reference observations on the reverse strand&quot;&gt;
##INFO=&lt;ID=SAF,Number=A,Type=Integer,Description=&quot;Number of alternate observations on the forward strand&quot;&gt;
##INFO=&lt;ID=SAR,Number=A,Type=Integer,Description=&quot;Number of alternate observations on the reverse strand&quot;&gt;
##INFO=&lt;ID=SRP,Number=1,Type=Float,Description=&quot;Strand balance probability for the reference allele: Phred-scaled upper-bounds estimate of the probability of observing the deviation between SRF and SRR given E(SRF/SRR) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=SAP,Number=A,Type=Float,Description=&quot;Strand balance probability for the alternate allele: Phred-scaled upper-bounds estimate of the probability of observing the deviation between SAF and SAR given E(SAF/SAR) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=AB,Number=A,Type=Float,Description=&quot;Allele balance at heterozygous sites: a number between 0 and 1 representing the ratio of reads showing the reference allele to all reads, considering only reads from individuals called as heterozygous&quot;&gt;
##INFO=&lt;ID=ABP,Number=A,Type=Float,Description=&quot;Allele balance probability at heterozygous sites: Phred-scaled upper-bounds estimate of the probability of observing the deviation between ABR and ABA given E(ABR/ABA) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=RUN,Number=A,Type=Integer,Description=&quot;Run length: the number of consecutive repeats of the alternate allele in the reference genome&quot;&gt;
##INFO=&lt;ID=RPP,Number=A,Type=Float,Description=&quot;Read Placement Probability: Phred-scaled upper-bounds estimate of the probability of observing the deviation between RPL and RPR given E(RPL/RPR) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=RPPR,Number=1,Type=Float,Description=&quot;Read Placement Probability for reference observations: Phred-scaled upper-bounds estimate of the probability of observing the deviation between RPL and RPR given E(RPL/RPR) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=RPL,Number=A,Type=Float,Description=&quot;Reads Placed Left: number of reads supporting the alternate balanced to the left (5') of the alternate allele&quot;&gt;
##INFO=&lt;ID=RPR,Number=A,Type=Float,Description=&quot;Reads Placed Right: number of reads supporting the alternate balanced to the right (3') of the alternate allele&quot;&gt;
##INFO=&lt;ID=EPP,Number=A,Type=Float,Description=&quot;End Placement Probability: Phred-scaled upper-bounds estimate of the probability of observing the deviation between EL and ER given E(EL/ER) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=EPPR,Number=1,Type=Float,Description=&quot;End Placement Probability for reference observations: Phred-scaled upper-bounds estimate of the probability of observing the deviation between EL and ER given E(EL/ER) ~ 0.5, derived using Hoeffding's inequality&quot;&gt;
##INFO=&lt;ID=DPRA,Number=A,Type=Float,Description=&quot;Alternate allele depth ratio.  Ratio between depth in samples with each called alternate allele and those without.&quot;&gt;
##INFO=&lt;ID=ODDS,Number=1,Type=Float,Description=&quot;The log odds ratio of the best genotype combination to the second-best.&quot;&gt;
##INFO=&lt;ID=GTI,Number=1,Type=Integer,Description=&quot;Number of genotyping iterations required to reach convergence or bailout.&quot;&gt;
##INFO=&lt;ID=TYPE,Number=A,Type=String,Description=&quot;The type of allele, either snp, mnp, ins, del, or complex.&quot;&gt;
##INFO=&lt;ID=CIGAR,Number=A,Type=String,Description=&quot;The extended CIGAR representation of each alternate allele, with the exception that '=' is replaced by 'M' to ease VCF parsing.  Note that INDEL alleles do not have the first matched base (which is provided by default, per the spec) referred to by the CIGAR.&quot;&gt;
##INFO=&lt;ID=NUMALT,Number=1,Type=Integer,Description=&quot;Number of unique non-reference alleles in called genotypes at this position.&quot;&gt;
##INFO=&lt;ID=MEANALT,Number=A,Type=Float,Description=&quot;Mean number of unique non-reference allele observations per sample with the corresponding alternate alleles.&quot;&gt;
##INFO=&lt;ID=LEN,Number=A,Type=Integer,Description=&quot;allele length&quot;&gt;
##INFO=&lt;ID=MQM,Number=A,Type=Float,Description=&quot;Mean mapping quality of observed alternate alleles&quot;&gt;
##INFO=&lt;ID=MQMR,Number=1,Type=Float,Description=&quot;Mean mapping quality of observed reference alleles&quot;&gt;
##INFO=&lt;ID=PAIRED,Number=A,Type=Float,Description=&quot;Proportion of observed alternate alleles which are supported by properly paired read fragments&quot;&gt;
##INFO=&lt;ID=PAIREDR,Number=1,Type=Float,Description=&quot;Proportion of observed reference alleles which are supported by properly paired read fragments&quot;&gt;
##INFO=&lt;ID=MIN_DP,Number=1,Type=Integer,Description=&quot;Minimum depth in gVCF output block.&quot;&gt;
##INFO=&lt;ID=END,Number=1,Type=Integer,Description=&quot;Last position (inclusive) in gVCF output record.&quot;&gt;
##FORMAT=&lt;ID=GT,Number=1,Type=String,Description=&quot;Genotype&quot;&gt;
##FORMAT=&lt;ID=GQ,Number=1,Type=Float,Description=&quot;Genotype Quality, the Phred-scaled marginal (or unconditional) probability of the called genotype&quot;&gt;
##FORMAT=&lt;ID=GL,Number=G,Type=Float,Description=&quot;Genotype Likelihood, log10-scaled likelihoods of the data given the called genotype for each possible genotype generated from the reference and alternate alleles given the sample ploidy&quot;&gt;
##FORMAT=&lt;ID=DP,Number=1,Type=Integer,Description=&quot;Read Depth&quot;&gt;
##FORMAT=&lt;ID=AD,Number=R,Type=Integer,Description=&quot;Number of observation for each allele&quot;&gt;
##FORMAT=&lt;ID=RO,Number=1,Type=Integer,Description=&quot;Reference allele observation count&quot;&gt;
##FORMAT=&lt;ID=QR,Number=1,Type=Integer,Description=&quot;Sum of quality of the reference observations&quot;&gt;
##FORMAT=&lt;ID=AO,Number=A,Type=Integer,Description=&quot;Alternate allele observation count&quot;&gt;
##FORMAT=&lt;ID=QA,Number=A,Type=Integer,Description=&quot;Sum of quality of the alternate observations&quot;&gt;
##FORMAT=&lt;ID=MIN_DP,Number=1,Type=Integer,Description=&quot;Minimum depth in gVCF output block.&quot;&gt;
</code></pre>



      </main>
    </div>
    
<footer id="footer" class="mt-auto text-center text-muted">
  <div class="container">
    AN LAB | CC-BY
  </div>
</footer>


    <script src="https://nekrut.github.io/lab_site/js/feather.min.js"></script>
<script>
  feather.replace()
</script>


<script src="https://nekrut.github.io/lab_site/js/jquery-3.3.1.slim.min.js"></script>
<script src="https://nekrut.github.io/lab_site/js/bootstrap.bundle.min.js"></script>

    
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  </body>
</html>